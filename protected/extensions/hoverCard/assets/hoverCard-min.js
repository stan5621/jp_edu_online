(function(b){var d=null,c=null,a="bm_hover_card";b.fn.hoverCard=function(e){var f=b.extend({},b.fn.hoverCard.defaults,e);return b(this).each(function(){var g=b(this);g.live("mouseover",function(h){removeShowedCard();showCard(g,f);h.stopPropagation()}).live("mouseout",function(h){if(!b(this).data("current")){clearQueue(d)}else{removeCard(f.removeTimeout);b(".bm_hover_card").hover(function(){clearQueue(c)},function(){removeCard(f.removeTimeout)})}b(this).removeData("current");h.stopPropagation()})})};hoverCardBuilder=function(k,l){var f=k.offset().top+k.height()-6,e=k.offset().left-104+k.width()/2;var n=b("<div>").addClass(a).css({top:f,left:e});var g=b("<div>").addClass(a+"_arrow");var h=b("<div>").addClass(a+"_border");var i=b("<img>").attr({src:l}).addClass("loading");var m=b("<div>").addClass(a+"_before").html(i);var j=b("<div>").addClass(a+"_container").html(m);n.append(g).append(h).append(j);return n};showCard=function(e,g){if(e&&!e.data("current")){var f=hoverCardBuilder(e,g.placeHolder);d=setTimeout(function(){b("body").prepend(f);e.data("current",true);getCardData(e,g)},g.showTimeout)}};removeCard=function(e){};clearQueue=function(e){!!e&&clearTimeout(e)};removeShowedCard=function(){clearQueue(d);clearQueue(c);b("."+a).remove()};getCardData=function(e,f){if(!!f.url){b.ajax({url:f.url,type:f.type,data:{id:e.attr("bm_user_id")},dataType:f.dataType,timeout:8000,success:function(g){b("."+a+"_container").html(g)},error:function(){b("."+a+"_before").text(f.errorText)}})}else{b("."+a+"_before").text(f.errorText)}};b.fn.hoverCard.defaults={url:null,type:"get",dataType:"html",showTimeout:300,removeTimeout:400,errorText:"\u8bfb\u53d6\u9519\u8bef",placeHolder:"./images/loading.gif",}})(jQuery);
